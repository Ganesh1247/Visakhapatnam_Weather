<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGlance | AI Weather & Air Quality</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            900: '#0B1120',
                            800: '#162032',
                            700: '#1E293B',
                        },
                        light: {
                            50: '#F8FAFC',
                            100: '#F1F5F9',
                            200: '#E2E8F0',
                        },
                        brand: {
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style type="text/tailwindcss">
        @layer utilities {
            /* Premium Glassmorphism */
            .glass {
                @apply bg-white/10 backdrop-blur-xl border border-white/20 shadow-[0_8px_32px_0_rgba(31,38,135,0.37)];
            }
            .glass-panel {
                @apply bg-white/5 backdrop-blur-lg border border-white/10 shadow-2xl;
            }
            .glass-card {
                @apply bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all duration-300;
            }
            
            /* Text Gradients */
            .text-glow {
                text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
            }
            .bg-mesh {
                background-color: #030712;
                background-image: 
                    radial-gradient(at 0% 0%, hsla(253,16%,17%,1) 0, transparent 50%), 
                    radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                    radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            }
        }
        
        body {
            transition: all 0.5s ease;
        }

        /* Modern Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            @apply bg-slate-400/20 rounded-full hover:bg-slate-400/40;
        }
    </style>
</head>

<body
    class="bg-mesh font-sans antialiased text-slate-200 min-h-screen selection:bg-brand-500 selection:text-white transition-colors duration-500 flex flex-col overflow-x-hidden">

    <!-- Premium Navigation -->
    <nav class="fixed top-0 w-full z-50 backdrop-blur-xl border-b border-white/5 transition-all duration-300"
        id="navbar">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between relative z-50">
            <!-- Brand -->
            <div class="flex items-center gap-4 group cursor-pointer" onclick="location.reload()">
                <div class="relative">
                    <div
                        class="w-10 h-10 sm:w-12 sm:h-12 rounded-2xl bg-gradient-to-tr from-brand-400 to-indigo-600 flex items-center justify-center shadow-lg shadow-brand-500/20 group-hover:rotate-12 transition-transform duration-500">
                        <i class="ri-leaf-line text-xl sm:text-2xl text-white"></i>
                    </div>
                </div>
                <div>
                    <h1
                        class="font-heading font-bold text-xl sm:text-2xl tracking-tighter text-white group-hover:text-brand-400 transition-colors">
                        EcoGlance</h1>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="flex items-center gap-2 sm:gap-4">
                <!-- Desktop Controls -->
                <div class="hidden lg:flex items-center gap-4">
                    <div class="flex items-center bg-white/5 border border-white/10 rounded-2xl p-1 gap-1">
                        <button onclick="setMethod('mc_dropout')" id="btn-mc"
                            class="px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-white/10 text-white/60">MC
                            Dropout</button>
                        <button onclick="setMethod('quantile')" id="btn-quantile"
                            class="px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-white/10 text-white/60">Quantile</button>
                        <button onclick="setMethod('conformal')" id="btn-conformal"
                            class="px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-white/10 text-white/60">Conformal</button>
                    </div>

                    <button onclick="fetchPrediction()"
                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-white/60 hover:text-white transition-all">
                        <i class="ri-refresh-line text-lg"></i>
                    </button>
                    <button onclick="document.getElementById('stats-modal').classList.remove('hidden')"
                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-white/60 hover:text-white transition-all">
                        <i class="ri-bar-chart-box-line text-lg"></i>
                    </button>

                    <div class="h-8 w-px bg-white/10 mx-2"></div>

                    <a href="/logout"
                        class="flex items-center gap-3 px-5 py-2.5 rounded-2xl bg-white/5 border border-white/10 text-sm font-bold text-white/80 hover:bg-white/10 hover:border-white/20 transition-all group">
                        <span>Sign Out</span>
                        <i
                            class="ri-logout-box-r-line group-hover:translate-x-1 transition-transform text-brand-400"></i>
                    </a>
                </div>

                <!-- Mobile Menu Toggle -->
                <button onclick="toggleMobileMenu()"
                    class="lg:hidden w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-white">
                    <i class="ri-menu-4-line text-2xl" id="menu-icon"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu"
            class="hidden lg:hidden border-t border-white/5 bg-[#030712]/95 backdrop-blur-2xl absolute top-full left-0 w-full opacity-0 translate-y-[-10px] transition-all duration-300 z-40">
            <div class="p-6 space-y-6">
                <!-- Sync Status Indicator -->
                <div class="flex items-center gap-3 px-4 py-2 bg-white/5 rounded-xl border border-white/10">
                    <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                    <span id="engine-status-text"
                        class="text-[9px] font-black text-white/40 uppercase tracking-[0.2em]">Engine:
                        Operational</span>
                </div>

                <div class="space-y-3">
                    <p class="text-[10px] font-black text-white/20 uppercase tracking-widest ml-1">Prediction Core</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setMethod('mc_dropout'); toggleMobileMenu()" id="btn-mc-mob"
                            class="py-3 rounded-xl bg-white/5 text-[10px] font-bold text-white/60 border border-white/5">MC
                            Dropout</button>
                        <button onclick="setMethod('quantile'); toggleMobileMenu()" id="btn-quantile-mob"
                            class="py-3 rounded-xl bg-white/5 text-[10px] font-bold text-white/60 border border-white/5">Quantile</button>
                        <button onclick="setMethod('conformal'); toggleMobileMenu()" id="btn-conformal-mob"
                            class="py-3 rounded-xl bg-white/5 text-[10px] font-bold text-white/60 border border-white/5">Conformal</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="fetchPrediction(); toggleMobileMenu()"
                        class="flex items-center justify-center gap-3 py-4 rounded-2xl bg-brand-500/10 border border-brand-500/20 text-brand-400 font-bold text-sm">
                        <i class="ri-refresh-line"></i> Sync Data
                    </button>
                    <button
                        onclick="document.getElementById('stats-modal').classList.remove('hidden'); toggleMobileMenu()"
                        class="flex items-center justify-center gap-3 py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-bold text-sm">
                        <i class="ri-bar-chart-box-line"></i> Diagnostics
                    </button>
                </div>

                <a href="/logout"
                    class="flex items-center justify-center gap-3 py-4 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-400 font-bold text-sm">
                    <i class="ri-logout-box-r-line"></i> Sign Out
                </a>
            </div>
        </div>
    </nav>

    <!-- Dynamic Background Elements -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden -z-10">
        <div
            class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-brand-500/10 rounded-full blur-[120px] animate-pulse">
        </div>
        <div
            class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-500/10 rounded-full blur-[120px] animation-delay-2000 animate-pulse">
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-32 pb-20 px-6 max-w-7xl mx-auto w-full flex-grow relative z-10">

        <!-- Top Hero Section (Unified Current Weather) -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">

            <!-- Hero Card: Current Weather -->
            <div class="lg:col-span-8 group">
                <div
                    class="glass-panel rounded-[40px] p-6 sm:p-10 h-full relative overflow-hidden transition-all duration-500 hover:border-white/20">
                    <div class="relative z-10 h-full flex flex-col justify-between">
                        <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                            <div>
                                <div class="flex items-center gap-3 mb-4 sm:mb-6">
                                    <span
                                        class="px-4 py-1.5 rounded-full bg-brand-500/20 text-brand-400 text-[10px] font-black uppercase tracking-widest border border-brand-500/30">Live
                                        Now</span>
                                    <span class="text-white/40 text-[11px] font-bold uppercase tracking-widest"
                                        id="current-date">--</span>
                                </div>
                                <div class="flex items-center gap-4 sm:gap-6">
                                    <h2 class="text-7xl sm:text-[120px] font-heading font-bold text-white leading-none tracking-tighter text-glow"
                                        id="temp-main">--¬∞</h2>
                                    <div class="space-y-1">
                                        <p class="text-xl sm:text-2xl font-bold text-white/90" id="weather-desc">--</p>
                                        <p class="text-xs sm:text-sm text-white/40 font-medium">Feels like <span
                                                id="feels-like" class="text-white/60">--¬∞</span></p>
                                    </div>
                                </div>
                            </div>
                            <div class="text-9xl sm:text-[160px] filter drop-shadow-[0_0_30px_rgba(255,255,255,0.2)] animate-pulse-slow transition-transform hover:scale-110 duration-700 mx-auto sm:mx-0"
                                id="weather-icon-main">
                                ‚òÄÔ∏è
                            </div>
                        </div>

                        <!-- Weather Detail Grid -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-8 sm:mt-12">
                            <div class="glass-card rounded-3xl p-4 sm:p-5">
                                <p
                                    class="text-[9px] sm:text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">
                                    Humidity
                                </p>
                                <div class="flex items-center gap-2 sm:gap-3">
                                    <div
                                        class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                                        <i class="ri-drop-fill text-lg"></i>
                                    </div>
                                    <span class="text-lg sm:text-xl font-bold text-white/90"
                                        id="humidity-detail">--%</span>
                                </div>
                            </div>
                            <div class="glass-card rounded-3xl p-4 sm:p-5">
                                <p
                                    class="text-[9px] sm:text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">
                                    Wind
                                    Speed</p>
                                <div class="flex items-center gap-2 sm:gap-3">
                                    <div
                                        class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center text-cyan-400">
                                        <i class="ri-windy-line text-lg"></i>
                                    </div>
                                    <span class="text-lg sm:text-xl font-bold text-white/90" id="wind-detail">--</span>
                                </div>
                            </div>
                            <div class="glass-card rounded-3xl p-4 sm:p-5">
                                <p
                                    class="text-[9px] sm:text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">
                                    Pressure
                                </p>
                                <div class="flex items-center gap-2 sm:gap-3">
                                    <div
                                        class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400">
                                        <i class="ri-speed-mini-line text-lg"></i>
                                    </div>
                                    <span class="text-lg sm:text-xl font-bold text-white/90">1012 <span
                                            class="text-[10px] opacity-40">hPa</span></span>
                                </div>
                            </div>
                            <div class="glass-card rounded-3xl p-4 sm:p-5">
                                <p
                                    class="text-[9px] sm:text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">
                                    Rainfall</p>
                                <div class="flex items-center gap-2 sm:gap-3">
                                    <div
                                        class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                                        <i class="ri-umbrella-line text-lg"></i>
                                    </div>
                                    <span class="text-lg sm:text-xl font-bold text-white/90" id="rain-detail">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AQI Summary Card -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <div
                    class="glass-panel rounded-[40px] p-8 flex-grow flex flex-col items-center justify-center text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-brand-500/5 to-transparent opacity-50"></div>
                    <p class="text-[11px] font-black text-white/30 uppercase tracking-[0.3em] mb-8 relative z-10">Air
                        Quality Index</p>

                    <div class="relative w-44 h-44 mb-6 group cursor-help">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.05)"
                                stroke-width="6" />
                            <circle id="aqi-ring" cx="50" cy="50" r="45" fill="none" stroke="url(#aqiGradient)"
                                stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round"
                                class="transition-all duration-1000 ease-out" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-heading font-black text-white tracking-tighter"
                                id="pm25-large">--</span>
                            <span
                                class="text-[10px] font-bold text-white/30 uppercase tracking-widest mt-1">PM2.5</span>
                        </div>
                        <div
                            class="absolute -inset-4 bg-brand-500/10 rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                    </div>

                    <div class="px-6 py-2 rounded-2xl bg-white/5 border border-white/10 text-xs font-black uppercase tracking-[0.2em] text-white/60 mb-8"
                        id="aqi-status-badge">
                        Calibrating...
                    </div>

                    <div class="w-full grid grid-cols-2 gap-4">
                        <div class="bg-white/5 rounded-2xl p-4 border border-white/5">
                            <p class="text-[10px] font-bold text-white/20 uppercase mb-1">PM10</p>
                            <p class="text-lg font-bold text-white/80" id="pm10-metric">--</p>
                        </div>
                        <div class="bg-white/5 rounded-2xl p-4 border border-white/5">
                            <p class="text-[10px] font-bold text-white/20 uppercase mb-1">SO‚ÇÇ</p>
                            <p class="text-lg font-bold text-white/80">12.5</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Section: Visualizations & Forecast -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Forecast Visuals -->
            <div class="lg:col-span-8 space-y-8">
                <!-- Trend Chart -->
                <div class="glass-panel rounded-[40px] p-6 sm:p-8">
                    <div class="flex justify-between items-center mb-10">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-10 h-10 rounded-2xl bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                                <i class="ri-pulse-line text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-heading font-black text-lg text-white/90">Predictive Analytics</h3>
                                <p class="text-xs text-white/30 font-bold uppercase tracking-widest">7-Day Temporal
                                    Trend</p>
                            </div>
                        </div>
                    </div>
                    <div class="h-64 sm:h-80 w-full">
                        <canvas id="forecastChart"></canvas>
                    </div>
                </div>

                <!-- 7-Day Forecast Grid -->
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <div class="w-8 h-8 rounded-xl bg-white/5 flex items-center justify-center text-white/40">
                            <i class="ri-calendar-line"></i>
                        </div>
                        <h3 class="text-[11px] font-black text-white/40 uppercase tracking-[0.4em]">Extended Outlook
                        </h3>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3 sm:gap-4" id="forecast-list">
                        <!-- Items injected via JS -->
                    </div>
                </div>
            </div>

            <!-- Right Column: Advisory -->
            <div class="lg:col-span-4">
                <div class="glass-panel rounded-[40px] p-8 h-full sticky top-32">
                    <div class="flex items-center gap-4 mb-10">
                        <div class="w-10 h-10 rounded-2xl bg-red-500/20 flex items-center justify-center text-red-400">
                            <i class="ri-heart-pulse-line text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-heading font-black text-lg text-white/90">Health Advisory</h3>
                            <p class="text-xs text-white/30 font-bold uppercase tracking-widest">AI Safety Engine</p>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <div class="bg-white/5 rounded-3xl p-6 border border-white/5">
                            <div class="flex gap-4 items-start">
                                <div class="text-3xl" id="rec-icon">üõ°Ô∏è</div>
                                <div>
                                    <h4 class="text-sm font-black text-white/90 uppercase mb-2 tracking-wide"
                                        id="rec-title">Status Check</h4>
                                    <p class="text-xs text-white/40 leading-relaxed font-medium" id="rec-summary">Our
                                        models are currently analyzing data...</p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <p class="text-[10px] font-black text-green-500/60 uppercase tracking-[0.3em] mb-4">
                                    Recommended Actions</p>
                                <ul class="space-y-3" id="rec-do">
                                    <li class="flex items-center gap-3">
                                        <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                                        <span class="text-xs font-bold text-white/50">Computing...</span>
                                    </li>
                                </ul>
                            </div>

                            <div id="rec-avoid-section" class="hidden">
                                <p class="text-[10px] font-black text-red-500/60 uppercase tracking-[0.3em] mb-4">
                                    Precautions</p>
                                <ul class="space-y-3" id="rec-avoid">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <defs>
            <linearGradient id="aqiGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#10b981" />
                <stop offset="50%" stop-color="#eab308" />
                <stop offset="100%" stop-color="#ef4444" />
            </linearGradient>
        </defs>

        <!-- How It Works Section -->
        <div class="mt-20 mb-8">
            <h3 class="text-2xl font-heading font-black text-center mb-12 text-white/90 uppercase tracking-widest">Model
                Intelligence</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- MC Dropout -->
                <div class="p-8 rounded-[32px] glass-panel border border-white/5">
                    <div
                        class="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center text-blue-500 mb-6">
                        <i class="ri-brain-line text-2xl"></i>
                    </div>
                    <h4 class="text-lg font-black mb-3 text-white">MC Dropout</h4>
                    <p class="text-xs text-white/40 leading-relaxed font-medium">
                        Stochastic inference that simulates multiple future scenarios by randomly sampling neural
                        connections.
                    </p>
                    <div
                        class="mt-6 text-[9px] font-black text-blue-500 uppercase tracking-widest bg-blue-500/5 py-1 px-3 rounded-full inline-block">
                        Temporal Precision</div>
                </div>

                <!-- Quantile -->
                <div class="p-8 rounded-[32px] glass-panel border border-white/5">
                    <div
                        class="w-12 h-12 rounded-2xl bg-purple-500/10 flex items-center justify-center text-purple-500 mb-6">
                        <i class="ri-bar-chart-grouped-line text-2xl"></i>
                    </div>
                    <h4 class="text-lg font-black mb-3 text-white">Quantile Reg</h4>
                    <p class="text-xs text-white/40 leading-relaxed font-medium">
                        Predicts full probability distributions, highlighting the 10th-90th percentile bounds for risk.
                    </p>
                    <div
                        class="mt-6 text-[9px] font-black text-purple-500 uppercase tracking-widest bg-purple-500/5 py-1 px-3 rounded-full inline-block">
                        Distribution Analysis</div>
                </div>

                <!-- Conformal -->
                <div class="p-8 rounded-[32px] glass-panel border border-white/5">
                    <div
                        class="w-12 h-12 rounded-2xl bg-orange-500/10 flex items-center justify-center text-orange-500 mb-6">
                        <i class="ri-shield-check-line text-2xl"></i>
                    </div>
                    <h4 class="text-lg font-black mb-3 text-white">Conformal</h4>
                    <p class="text-xs text-white/40 leading-relaxed font-medium">
                        Mathematical guarantee framework ensuring the true value lies within the predicted interval.
                    </p>
                    <div
                        class="mt-6 text-[9px] font-black text-orange-500 uppercase tracking-widest bg-orange-500/5 py-1 px-3 rounded-full inline-block">
                        Statistical Safety</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Updated Footer -->
    <footer class="border-t border-white/5 bg-[#030712] relative z-20">
        <div class="max-w-7xl mx-auto px-6 py-16">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12 sm:gap-20">
                <!-- About -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-gradient-to-tr from-brand-500 to-indigo-600 flex items-center justify-center">
                            <i class="ri-leaf-line text-white"></i>
                        </div>
                        <span class="font-heading font-bold text-2xl text-white">EcoGlance</span>
                    </div>
                    <p class="text-xs text-white/30 leading-relaxed font-medium">
                        A next-generation atmospheric intelligence platform. We utilize hybrid deep learning
                        architectures to project environmental safety indices with scientific certainty.
                    </p>
                </div>

                <!-- Tech -->
                <div class="space-y-6">
                    <h4 class="text-[10px] font-black text-white/20 uppercase tracking-[0.3em]">Core Architecture</h4>
                    <div class="space-y-4">
                        <div class="flex items-center gap-4">
                            <div class="w-1.5 h-1.5 rounded-full bg-brand-500"></div>
                            <span class="text-xs font-bold text-white/60">LSTM Temporal Embeddings</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>
                            <span class="text-xs font-bold text-white/60">XGBoost Residual Mapping</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                            <span class="text-xs font-bold text-white/60">Bayesian Uncertainty Quant</span>
                        </div>
                    </div>
                </div>

                <!-- Contact -->
                <div class="space-y-6">
                    <h4 class="text-[10px] font-black text-white/20 uppercase tracking-[0.3em]">Communication</h4>
                    <div class="space-y-3">
                        <p class="text-sm font-bold text-white/80">+91 8790627210</p>
                        <p class="text-sm font-bold text-brand-500">support@ecoglance.ai</p>
                    </div>
                    <div class="flex gap-4 pt-2">
                        <i
                            class="ri-github-line text-xl text-white/20 hover:text-white transition-colors cursor-pointer"></i>
                        <i
                            class="ri-twitter-x-line text-xl text-white/20 hover:text-white transition-colors cursor-pointer"></i>
                    </div>
                </div>
            </div>

            <div class="mt-20 pt-8 border-t border-white/5 text-center">
                <p class="text-[9px] font-black text-white/10 uppercase tracking-[0.5em]">&copy; 2026 VSV ARCHIVE PORTAL
                </p>
            </div>
        </div>
    </footer>

    <!-- Stats Modal -->
    <div id="stats-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity"
            onclick="document.getElementById('stats-modal').classList.add('hidden')"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div
                class="bg-dark-800 border border-white/10 rounded-[40px] w-full max-w-3xl transform transition-all shadow-2xl overflow-hidden flex flex-col max-h-[90vh] bg-[#0B1120]">
                <div class="p-8 border-b border-white/10 flex justify-between items-center bg-white/5">
                    <div>
                        <h3 class="text-xl font-heading font-black text-white uppercase tracking-tight">Model
                            Diagnostics</h3>
                        <p class="text-[9px] font-black text-white/20 uppercase tracking-widest mt-1">Live Engine
                            Performance</p>
                    </div>
                    <button onclick="document.getElementById('stats-modal').classList.add('hidden')"
                        class="text-white/20 hover:text-red-500 transition">
                        <i class="ri-close-circle-line text-3xl"></i>
                    </button>
                </div>
                <div class="p-8 overflow-y-auto">
                    <div class="overflow-x-auto rounded-2xl border border-white/5 bg-black/20">
                        <table class="w-full text-sm text-left text-white/60">
                            <thead class="text-[10px] uppercase bg-white/5 text-white/40">
                                <tr>
                                    <th scope="col" class="px-6 py-4 font-black">Target Variable</th>
                                    <th scope="col" class="px-6 py-4 font-black">RMSE</th>
                                    <th scope="col" class="px-6 py-4 font-black">MAE</th>
                                    <th scope="col" class="px-6 py-4 font-black">R¬≤ Score</th>
                                </tr>
                            </thead>
                            <tbody id="stats-body" class="divide-y divide-white/5">
                                <tr>
                                    <td colspan="4"
                                        class="px-6 py-12 text-center text-[10px] font-black text-white/10 uppercase tracking-[0.3em]">
                                        Querying Core Metrics...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading"
        class="fixed inset-0 z-[200] bg-[#030712]/90 backdrop-blur-xl flex flex-col items-center justify-center transition-opacity"
        style="display: none;">
        <div class="relative">
            <div class="w-24 h-24 border-[6px] border-brand-500/10 border-t-brand-500 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i class="ri-rocket-2-line text-2xl text-brand-500 animate-pulse"></i>
            </div>
        </div>
        <div class="text-white font-heading font-black text-xl mt-8 tracking-tighter animate-pulse">Running AI Forecast
        </div>
        <p class="text-white/20 text-[10px] font-black uppercase tracking-[0.3em] mt-2">Connecting to Intelligence
            Engine</p>
    </div>


    <!-- JAVASCRIPT LOGIC -->
    <script>
        let currentMethod = 'mc_dropout';
        let currentDataCache = null;
        let forecastChart = null;

        // --- THEME & UI ---
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const icon = document.getElementById('menu-icon');

            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                icon.className = 'ri-close-line text-2xl';
                setTimeout(() => {
                    menu.classList.add('opacity-100', 'translate-y-0');
                    menu.classList.remove('opacity-0', 'translate-y-[-10px]');
                }, 10);
            } else {
                menu.classList.add('opacity-0', 'translate-y-[-10px]');
                menu.classList.remove('opacity-100', 'translate-y-0');
                setTimeout(() => {
                    menu.classList.add('hidden');
                    icon.className = 'ri-menu-4-line text-2xl';
                }, 300);
            }
        }

        function setMethod(method) {
            currentMethod = method;

            // Update UI buttons (Sync Desktop & Mobile)
            ['mc', 'quantile', 'conformal'].forEach(m => {
                const btns = document.querySelectorAll(`[id^="btn-${m}"]`);
                btns.forEach(btn => {
                    if (m === method.replace('_', '')) {
                        btn.classList.add('bg-white/10', 'text-white', 'border-white/20');
                        btn.classList.remove('text-white/60');
                    } else {
                        btn.classList.remove('bg-white/10', 'text-white', 'border-white/20');
                        btn.classList.add('text-white/60');
                    }
                });
            });

            fetchPrediction();
        }

        // --- CHART JS ---
        function initChart(forecastData) {
            if (!forecastData || forecastData.length === 0) return;
            currentDataCache = { forecast: forecastData };

            const ctxCheck = document.getElementById('forecastChart');
            if (!ctxCheck) return;

            const ctx = ctxCheck.getContext('2d');

            const labels = forecastData.map(d => {
                const date = new Date(d.date);
                return date.toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' });
            });

            const tempData = forecastData.map(d => parseFloat(d.temp_avg) || 0);
            const pmData = forecastData.map(d => parseFloat(d.pm2_5) || 0);

            if (forecastChart) forecastChart.destroy();

            const gridColor = 'rgba(255, 255, 255, 0.03)';
            const textColor = 'rgba(255, 255, 255, 0.4)';

            const gradientTemp = ctx.createLinearGradient(0, 0, 0, 400);
            gradientTemp.addColorStop(0, 'rgba(56, 189, 248, 0.2)');
            gradientTemp.addColorStop(1, 'rgba(56, 189, 248, 0.0)');

            const gradientPM = ctx.createLinearGradient(0, 0, 0, 400);
            gradientPM.addColorStop(0, 'rgba(16, 185, 129, 0.2)');
            gradientPM.addColorStop(1, 'rgba(16, 185, 129, 0.0)');

            forecastChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Temp (¬∞C)',
                            data: tempData,
                            borderColor: '#38bdf8',
                            backgroundColor: gradientTemp,
                            borderWidth: 4,
                            pointBackgroundColor: '#030712',
                            pointBorderColor: '#38bdf8',
                            pointHoverRadius: 6,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'PM2.5',
                            data: pmData,
                            borderColor: '#10b981',
                            backgroundColor: gradientPM,
                            borderWidth: 4,
                            pointBackgroundColor: '#030712',
                            pointBorderColor: '#10b981',
                            pointHoverRadius: 6,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'end',
                            labels: {
                                color: 'rgba(255,255,255,0.7)',
                                usePointStyle: true,
                                boxWidth: 6,
                                font: { family: 'Inter', size: 10, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#fff',
                            titleFont: { family: 'Outfit', size: 14, weight: 'bold' },
                            bodyColor: 'rgba(255,255,255,0.8)',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: textColor, font: { size: 10 } } },
                        y: { position: 'left', grid: { color: gridColor }, ticks: { color: textColor } },
                        y1: { position: 'right', grid: { display: false }, ticks: { color: '#10b981', font: { size: 10 } } }
                    }
                }
            });
        }

        // --- HELPERS ---
        function getWeatherIcon(rainfall, temp) {
            if (rainfall > 15) return "‚õàÔ∏è";
            if (rainfall > 5) return "üåßÔ∏è";
            if (rainfall > 0.5) return "üå¶Ô∏è";
            if (temp > 35) return "‚òÄÔ∏è";
            if (temp > 30) return "‚òÄÔ∏è";
            return "üå§Ô∏è";
        }

        function getAQIColor(pm25) {
            const cls = { bg: 'rgba(16, 185, 129, 0.1)', text: '#10b981' };
            if (pm25 > 30) { cls.bg = 'rgba(234, 179, 8, 0.1)'; cls.text = '#eab308'; }
            if (pm25 > 60) { cls.bg = 'rgba(249, 115, 22, 0.1)'; cls.text = '#f97316'; }
            if (pm25 > 90) { cls.bg = 'rgba(239, 68, 68, 0.1)'; cls.text = '#ef4444'; }
            if (pm25 > 120) { cls.bg = 'rgba(153, 0, 76, 0.1)'; cls.text = '#99004c'; }
            return cls;
        }

        // --- FETCH LOGIC ---
        async function fetchPrediction() {
            const loading = document.getElementById('loading');
            loading.style.display = 'flex';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30s timeout for Render stability

                const res = await fetch(`/predict?method=${currentMethod}`, { signal: controller.signal });
                clearTimeout(timeoutId);

                if (!res.ok) {
                    const text = await res.text();
                    let errData;
                    try { errData = JSON.parse(text); } catch (e) { errData = { error: 'Interface Synchronization Failure' }; }
                    throw new Error(errData.error || 'Interface Sync Failure');
                }

                const data = await res.json();
                if (!data || !data.data) throw new Error('Fragmented Data Packet');

                // Update Engine Status
                const statusBadge = document.getElementById('aqi-status-badge');
                const engineText = document.getElementById('engine-status-text');
                if (data.forecast[0].engine === 'Standard (Lighter)') {
                    if (engineText) engineText.textContent = 'Engine: Standard (Light)';
                    statusBadge.innerHTML = 'Standard Mode <i class="ri-skip-forward-line ml-1"></i>';
                    statusBadge.title = 'Neural engine skipped to save RAM. Certainty scores may be limited.';
                } else {
                    if (engineText) engineText.textContent = 'Engine: Neural Link (90%)';
                }

                // Update Hero Content
                const tempVal = Math.round(data.data.temp_avg);
                document.getElementById('temp-main').innerHTML = `${tempVal}<span class="text-6xl text-white/20">¬∞</span>`;
                document.getElementById('feels-like').textContent = tempVal + '¬∞';
                document.getElementById('humidity-detail').textContent = Math.round(data.data.humidity) + '%';
                document.getElementById('wind-detail').innerHTML = `${data.data.wind_speed.toFixed(1)} <span class="text-[10px] opacity-40">m/s</span>`;
                document.getElementById('rain-detail').innerHTML = `${data.data.rainfall.toFixed(1)} <span class="text-[10px] opacity-40">mm</span>`;

                const weatherIcon = getWeatherIcon(data.data.rainfall, data.data.temp_avg);
                document.getElementById('weather-icon-main').textContent = weatherIcon;

                // Condition description
                let condition = 'Clear Skies';
                if (data.data.rainfall > 5) condition = 'Heavy Rain';
                else if (data.data.rainfall > 0.5) condition = 'Showers';
                else if (data.data.cloud_cover > 50) condition = 'Overcast';
                document.getElementById('weather-desc').textContent = condition;

                // Current Date
                const dateObj = new Date(data.prediction_date);
                document.getElementById('current-date').textContent = dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });

                // AQI Logic
                const pm25 = parseFloat(data.data.pm2_5) || 0;
                document.getElementById('pm25-large').textContent = Math.round(pm25);
                document.getElementById('pm10-metric').innerHTML = `${Math.round(data.data.pm10)} <span class="text-[10px] opacity-40">¬µg/m¬≥</span>`;

                const aqiStatus = document.getElementById('aqi-status-badge');
                aqiStatus.textContent = data.aqi.status;
                const aqiColors = getAQIColor(pm25);
                aqiStatus.style.backgroundColor = aqiColors.bg;
                aqiStatus.style.color = aqiColors.text;
                aqiStatus.style.borderColor = aqiColors.text + '20';

                // Gauge Update
                const ring = document.getElementById('aqi-ring');
                const circumference = 2 * Math.PI * 45;
                const progress = Math.min(pm25 / 100, 1);
                ring.style.strokeDashoffset = circumference * (1 - progress);

                // Recommendations
                if (data.aqi.recommendations) {
                    const rec = data.aqi.recommendations;
                    document.getElementById('rec-title').textContent = rec.title;
                    document.getElementById('rec-summary').textContent = rec.summary;
                    document.getElementById('rec-do').innerHTML = rec.do.slice(0, 3).map(x =>
                        `<li class="flex items-center gap-3">
                            <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                            <span class="text-xs font-bold text-white/50">${x}</span>
                        </li>`).join('');

                    if (rec.avoid && rec.avoid.length) {
                        document.getElementById('rec-avoid-section').classList.remove('hidden');
                        document.getElementById('rec-avoid').innerHTML = rec.avoid.slice(0, 2).map(x =>
                            `<li class="flex items-center gap-3">
                                <div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>
                                <span class="text-xs font-bold text-white/50">${x}</span>
                            </li>`).join('');
                    } else {
                        document.getElementById('rec-avoid-section').classList.add('hidden');
                    }
                }

                // Chart & Forecast List
                initChart(data.forecast);
                renderForecastList(data.forecast);

            } catch (err) {
                console.error(err);
                if (err.name === 'AbortError') {
                    alert('Neural Synthesis Timeout: The engine is under heavy load or spinning up. Please try again in 10 seconds.');
                } else {
                    alert('Intelligence Engine Sync Error: ' + err.message);
                }
            } finally {
                loading.style.display = 'none';
            }
        }

        function renderForecastList(forecast) {
            const container = document.getElementById('forecast-list');
            if (!container) return;
            container.innerHTML = forecast.map((d, i) => {
                const date = new Date(d.date);
                const day = date.toLocaleDateString('en-US', { weekday: 'short' });
                const icon = getWeatherIcon(d.rainfall, d.temp_avg);
                const isToday = i === 0;

                return `
                    <div class="glass-card rounded-[32px] p-4 flex flex-col items-center gap-3 group cursor-pointer ${isToday ? 'border-brand-500/50 bg-white/5' : ''}">
                        <span class="text-[9px] font-black uppercase tracking-widest ${isToday ? 'text-brand-400' : 'text-white/30'}">${day}</span>
                        <span class="text-3xl group-hover:scale-125 transition-transform duration-500">${icon}</span>
                        <div class="text-center">
                            <span class="text-base font-black text-white/90">${Math.round(d.temp_avg)}¬∞</span>
                            <div class="h-1 w-1 bg-white/10 rounded-full mx-auto mt-1"></div>
                        </div>
                        <span class="text-[8px] font-black text-green-500/40 uppercase tracking-tighter">${Math.round(d.pm2_5)} PM</span>
                    </div>
                `;
            }).join('');
        }

        async function fetchStats() {
            try {
                const res = await fetch('/stats');
                const data = await res.json();
                const body = document.getElementById('stats-body');

                if (!data || data.length === 0) {
                    body.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-white/30 font-black uppercase tracking-widest">No diagnostics available</td></tr>';
                    return;
                }

                body.innerHTML = data.map(m => `
                    <tr class="hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                        <th class="px-6 py-4 font-black text-white/90 uppercase tracking-wide text-[10px]">${(m.target || 'N/A').replace('xgb_chain_', '').replace('.pkl', '')}</th>
                        <td class="px-6 py-4 font-mono text-brand-400 font-bold">${Number(m.rmse || 0).toFixed(3)}</td>
                        <td class="px-6 py-4 font-mono text-indigo-400 font-bold">${Number(m.mae || 0).toFixed(3)}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-lg bg-white/5 text-[10px] font-black font-mono tracking-tighter ${(m.r2 || 0) > 0.8 ? 'text-green-400' : 'text-yellow-400'}">
                                ${Number(m.r2 || 0).toFixed(3)}
                            </span>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error(err);
            }
        }

        // --- INIT ---
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 20) nav.classList.add('bg-[#030712]/80', 'py-1');
            else nav.classList.remove('bg-[#030712]/80', 'py-1');
        });

        // Load initially
        document.addEventListener('DOMContentLoaded', () => {
            setMethod('mc_dropout');
            fetchStats();
        });
    </script>
</body>

</html>