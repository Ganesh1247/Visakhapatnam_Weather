<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGlance | AI Weather & Air Quality</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            900: '#0B1120',
                            800: '#162032',
                            700: '#1E293B',
                        },
                        light: {
                            50: '#F8FAFC',
                            100: '#F1F5F9',
                            200: '#E2E8F0',
                        },
                        brand: {
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style type="text/tailwindcss">
        @layer utilities {
            /* Premium Glassmorphism */
            .glass {
                @apply bg-white/10 backdrop-blur-xl border border-white/20 shadow-[0_8px_32px_0_rgba(31,38,135,0.37)];
            }
            .glass-panel {
                @apply bg-white/5 backdrop-blur-lg border border-white/10 shadow-2xl;
            }
            .glass-card {
                @apply bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all duration-300;
            }
            
            /* Text Gradients */
            .text-glow {
                text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
            }
            .bg-mesh {
                background-color: #030712;
                background-image: 
                    radial-gradient(at 0% 0%, hsla(253,16%,17%,1) 0, transparent 50%), 
                    radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                    radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            }
        }
        
        body {
            transition: all 0.5s ease;
        }

        /* Modern Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            @apply bg-slate-400/20 rounded-full hover:bg-slate-400/40;
        }
    </style>
</head>

<body
    class="bg-mesh font-sans antialiased text-slate-200 min-h-screen selection:bg-brand-500 selection:text-white transition-colors duration-500 flex flex-col overflow-x-hidden">

    <!-- Premium Navigation -->
    <nav class="fixed top-0 w-full z-50 backdrop-blur-xl border-b border-white/5 transition-all duration-300"
        id="navbar">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <!-- Brand -->
            <div class="flex items-center gap-4 group cursor-pointer">
                <div class="relative">
                    <div
                        class="w-12 h-12 rounded-2xl bg-gradient-to-tr from-brand-400 to-indigo-600 flex items-center justify-center shadow-lg shadow-brand-500/20 group-hover:rotate-12 transition-transform duration-500">
                        <i class="ri-leaf-line text-2xl text-white"></i>
                    </div>
                    <div
                        class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-[#030712] animate-pulse">
                    </div>
                </div>
                <div>
                    <h1
                        class="font-heading font-bold text-2xl tracking-tighter text-white group-hover:text-brand-400 transition-colors">
                        EcoGlance</h1>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold text-brand-500 uppercase tracking-[0.2em]">NextGen AI</span>
                        <div class="h-1 w-1 rounded-full bg-white/20"></div>
                        <span
                            class="text-[10px] font-medium text-white/40 uppercase tracking-[0.1em]">Visakhapatnam</span>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-4">
                <!-- Method Badge (Modern Select) -->
                <div class="hidden lg:flex items-center bg-white/5 border border-white/10 rounded-2xl p-1 gap-1">
                    <button onclick="setMethod('mc_dropout')" id="btn-mc"
                        class="px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-white/10 text-white/60 active">MC
                        Dropout</button>
                    <button onclick="setMethod('quantile')" id="btn-quantile"
                        class="px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-white/10 text-white/60">Quantile</button>
                    <button onclick="setMethod('conformal')" id="btn-conformal"
                        class="px-4 py-2 rounded-xl text-xs font-bold transition-all hover:bg-white/10 text-white/60">Conformal</button>
                </div>

                <div class="flex items-center gap-2 bg-white/5 border border-white/10 rounded-2xl p-1">
                    <button onclick="fetchPrediction()"
                        class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-white/10 text-white/60 hover:text-white transition-all">
                        <i class="ri-refresh-line text-lg"></i>
                    </button>
                    <button onclick="document.getElementById('stats-modal').classList.remove('hidden')"
                        class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-white/10 text-white/60 hover:text-white transition-all">
                        <i class="ri-bar-chart-box-line text-lg"></i>
                    </button>
                </div>

                <div class="h-8 w-px bg-white/10 mx-2"></div>

                <a href="/logout"
                    class="flex items-center gap-3 px-5 py-2.5 rounded-2xl bg-white/5 border border-white/10 text-sm font-bold text-white/80 hover:bg-white/10 hover:border-white/20 transition-all group">
                    <span>Sign Out</span>
                    <i class="ri-logout-box-r-line group-hover:translate-x-1 transition-transform text-brand-400"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Dynamic Background Elements -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden -z-10">
        <div
            class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-brand-500/10 rounded-full blur-[120px] animate-pulse">
        </div>
        <div
            class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-500/10 rounded-full blur-[120px] animation-delay-2000 animate-pulse">
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-32 pb-20 px-6 max-w-7xl mx-auto w-full flex-grow relative z-10">

        <!-- Top Hero Section (Unified Current Weather) -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">

            <!-- Hero Card: Current Weather -->
            <div class="lg:col-span-8 group">
                <div
                    class="glass-panel rounded-[40px] p-10 h-full relative overflow-hidden transition-all duration-500 hover:border-white/20">
                    <div class="relative z-10 h-full flex flex-col justify-between">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="flex items-center gap-3 mb-6">
                                    <span
                                        class="px-4 py-1.5 rounded-full bg-brand-500/20 text-brand-400 text-[10px] font-black uppercase tracking-widest border border-brand-500/30">Live
                                        Now</span>
                                    <span class="text-white/40 text-[11px] font-bold uppercase tracking-widest"
                                        id="current-date">--</span>
                                </div>
                                <div class="flex items-center gap-6">
                                    <h2 class="text-[120px] font-heading font-bold text-white leading-none tracking-tighter text-glow"
                                        id="temp-main">--¬∞</h2>
                                    <div class="space-y-1">
                                        <p class="text-2xl font-bold text-white/90" id="weather-desc">--</p>
                                        <p class="text-sm text-white/40 font-medium">Feels like <span id="feels-like"
                                                class="text-white/60">--¬∞</span></p>
                                    </div>
                                </div>
                            </div>
                            <div class="text-[160px] filter drop-shadow-[0_0_30px_rgba(255,255,255,0.2)] animate-pulse-slow transition-transform hover:scale-110 duration-700"
                                id="weather-icon-main">
                                ‚òÄÔ∏è
                            </div>
                        </div>

                        <!-- Weather Detail Grid -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-12">
                            <div class="glass-card rounded-3xl p-5">
                                <p class="text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">Humidity
                                </p>
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                                        <i class="ri-drop-fill text-lg"></i>
                                    </div>
                                    <span class="text-xl font-bold text-white/90" id="humidity-detail">--%</span>
                                </div>
                            </div>
                            <div class="glass-card rounded-3xl p-5">
                                <p class="text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">Wind
                                    Speed</p>
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center text-cyan-400">
                                        <i class="ri-windy-line text-lg"></i>
                                    </div>
                                    <span class="text-xl font-bold text-white/90" id="wind-detail">--</span>
                                </div>
                            </div>
                            <div class="glass-card rounded-3xl p-5">
                                <p class="text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">Pressure
                                </p>
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400">
                                        <i class="ri-speed-mini-line text-lg"></i>
                                    </div>
                                    <span class="text-xl font-bold text-white/90">1012 <span
                                            class="text-[10px] opacity-40">hPa</span></span>
                                </div>
                            </div>
                            <div class="glass-card rounded-3xl p-5">
                                <p class="text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mb-3">Chance
                                    of Rain</p>
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                                        <i class="ri-umbrella-line text-lg"></i>
                                    </div>
                                    <span class="text-xl font-bold text-white/90" id="rain-detail">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AQI Summary Card -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <div
                    class="glass-panel rounded-[40px] p-8 flex-grow flex flex-col items-center justify-center text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-brand-500/5 to-transparent opacity-50"></div>
                    <p class="text-[11px] font-black text-white/30 uppercase tracking-[0.3em] mb-8 relative z-10">Air
                        Quality Index</p>

                    <div class="relative w-44 h-44 mb-6 group cursor-help">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.05)"
                                stroke-width="6" />
                            <circle id="aqi-ring" cx="50" cy="50" r="45" fill="none" stroke="url(#aqiGradient)"
                                stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round"
                                class="transition-all duration-1000 ease-out" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-heading font-black text-white tracking-tighter"
                                id="pm25-large">--</span>
                            <span
                                class="text-[10px] font-bold text-white/30 uppercase tracking-widest mt-1">PM2.5</span>
                        </div>
                        <div
                            class="absolute -inset-4 bg-brand-500/10 rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                    </div>

                    <div class="px-6 py-2 rounded-2xl bg-white/5 border border-white/10 text-xs font-black uppercase tracking-[0.2em] text-white/60 mb-8"
                        id="aqi-status-badge">
                        Calibrating...
                    </div>

                    <div class="w-full grid grid-cols-2 gap-4">
                        <div class="bg-white/5 rounded-2xl p-4 border border-white/5">
                            <p class="text-[10px] font-bold text-white/20 uppercase mb-1">PM10</p>
                            <p class="text-lg font-bold text-white/80" id="pm10-metric">--</p>
                        </div>
                        <div class="bg-white/5 rounded-2xl p-4 border border-white/5">
                            <p class="text-[10px] font-bold text-white/20 uppercase mb-1">SO‚ÇÇ</p>
                            <p class="text-lg font-bold text-white/80">12.5</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Section: Visualizations & Forecast -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Forecast Visuals -->
            <div class="lg:col-span-8 space-y-8">
                <!-- Trend Chart -->
                <div class="glass-panel rounded-[40px] p-8">
                    <div class="flex justify-between items-center mb-10">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-10 h-10 rounded-2xl bg-indigo-500/20 flex items-center justify-center text-indigo-400">
                                <i class="ri-pulse-line text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-heading font-black text-lg text-white/90">Predictive Analytics</h3>
                                <p class="text-xs text-white/30 font-bold uppercase tracking-widest">7-Day Temporal
                                    Trend</p>
                            </div>
                        </div>
                    </div>
                    <div class="h-80 w-full">
                        <canvas id="forecastChart"></canvas>
                    </div>
                </div>

                <!-- 7-Day Forecast Grid -->
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <div class="w-8 h-8 rounded-xl bg-white/5 flex items-center justify-center text-white/40">
                            <i class="ri-calendar-line"></i>
                        </div>
                        <h3 class="text-[11px] font-black text-white/40 uppercase tracking-[0.4em]">Extended Outlook
                        </h3>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4" id="forecast-list">
                        <!-- Items injected via JS -->
                    </div>
                </div>
            </div>

            <!-- Right Column: Advisory -->
            <div class="lg:col-span-4">
                <div class="glass-panel rounded-[40px] p-8 h-full sticky top-32">
                    <div class="flex items-center gap-4 mb-10">
                        <div class="w-10 h-10 rounded-2xl bg-red-500/20 flex items-center justify-center text-red-400">
                            <i class="ri-heart-pulse-line text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-heading font-black text-lg text-white/90">Health Advisory</h3>
                            <p class="text-xs text-white/30 font-bold uppercase tracking-widest">AI Safety Engine</p>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <div class="bg-white/5 rounded-3xl p-6 border border-white/5">
                            <div class="flex gap-4 items-start">
                                <div class="text-3xl" id="rec-icon">üõ°Ô∏è</div>
                                <div>
                                    <h4 class="text-sm font-black text-white/90 uppercase mb-2 tracking-wide"
                                        id="rec-title">Status Check</h4>
                                    <p class="text-xs text-white/40 leading-relaxed font-medium" id="rec-summary">Our
                                        models are currently analyzing the environmental data to provide you with
                                        accurate safety recommendations.</p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <p class="text-[10px] font-black text-green-500/60 uppercase tracking-[0.3em] mb-4">
                                    Recommended Actions</p>
                                <ul class="space-y-3" id="rec-do">
                                    <li class="flex items-center gap-3">
                                        <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                                        <span class="text-xs font-bold text-white/50">Computing safety
                                            protocols...</span>
                                    </li>
                                </ul>
                            </div>

                            <div id="rec-avoid-section" class="hidden">
                                <p class="text-[10px] font-black text-red-500/60 uppercase tracking-[0.3em] mb-4">
                                    Precautions</p>
                                <ul class="space-y-3" id="rec-avoid">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <defs>
        <linearGradient id="aqiGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#10b981" />
            <stop offset="50%" stop-color="#eab308" />
            <stop offset="100%" stop-color="#ef4444" />
        </linearGradient>
    </defs>

    <!-- How It Works Section -->
    <div class="mt-12 mb-8">
        <h3 class="text-2xl font-heading font-semibold text-center mb-8 dark:text-white text-slate-800">Model
            Intelligence</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- MC Dropout -->
            <div class="p-6 rounded-3xl dark:glass-panel light-panel bg-white border border-slate-200">
                <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500 mb-4">
                    <i class="ri-brain-line text-xl"></i>
                </div>
                <h4 class="text-lg font-semibold mb-2 dark:text-white text-slate-800">MC Dropout</h4>
                <p class="text-sm dark:text-gray-400 text-slate-500 leading-relaxed">
                    Simulates multiple "possible futures" by randomly disabling neurons in the neural network to
                    calculate uncertainty.
                </p>
                <div class="mt-4 text-xs font-bold text-blue-500 uppercase tracking-wide">Best For: General Weather
                </div>
            </div>

            <!-- Quantile -->
            <div class="p-6 rounded-3xl dark:glass-panel light-panel bg-white border border-slate-200">
                <div
                    class="w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-500 mb-4">
                    <i class="ri-bar-chart-grouped-line text-xl"></i>
                </div>
                <h4 class="text-lg font-semibold mb-2 dark:text-white text-slate-800">Quantile Regression</h4>
                <p class="text-sm dark:text-gray-400 text-slate-500 leading-relaxed">
                    Predicts a median value and a confidence interval range (10th-90th percentile), making it
                    resistant to data outliers.
                </p>
                <div class="mt-4 text-xs font-bold text-purple-500 uppercase tracking-wide">Best For: Robust Data
                </div>
            </div>

            <!-- Conformal -->
            <div class="p-6 rounded-3xl dark:glass-panel light-panel bg-white border border-slate-200">
                <div
                    class="w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center text-orange-500 mb-4">
                    <i class="ri-shield-check-line text-xl"></i>
                </div>
                <h4 class="text-lg font-semibold mb-2 dark:text-white text-slate-800">Conformal Prediction</h4>
                <p class="text-sm dark:text-gray-400 text-slate-500 leading-relaxed">
                    A rigorous statistical framework that guarantees with 90% confidence that the true value falls
                    within the prediction.
                </p>
                <div class="mt-4 text-xs font-bold text-orange-500 uppercase tracking-wide">Best For: Safety
                    Critical</div>
            </div>
        </div>
    </div>

    </main>

    <!-- Updated Footer -->
    <footer class="border-t dark:border-white/5 border-slate-200 dark:bg-dark-900 bg-slate-50 relative z-50">
        <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:px-8">

            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">

                <!-- About Section -->
                <div>
                    <div class="flex items-center gap-2 mb-4">
                        <i class="ri-leaf-line text-brand-500 text-xl"></i>
                        <span class="font-heading font-bold text-xl dark:text-white text-slate-800">EcoGlance</span>
                    </div>
                    <p class="text-sm dark:text-gray-400 text-slate-500 leading-relaxed">
                        EcoGlance is a cutting-edge weather and air quality forecasting platform designed to provide
                        accurate, hyper-local predictions. We combine advanced AI with real-time data to help you plan
                        your day safely.
                    </p>
                </div>

                <!-- Methodology Section -->
                <div>
                    <h4 class="font-heading font-semibold dark:text-white text-slate-800 mb-4">Methodology</h4>
                    <p class="text-sm dark:text-gray-400 text-slate-500 leading-relaxed">
                        Our engine utilizes a <strong>Hybrid AI Architecture</strong>. We use Long Short-Term Memory
                        (<strong>LSTM</strong>) networks to capture temporal weather patterns, reinforced by
                        <strong>XGBoost</strong> for residual error correction and precise feature mapping.
                    </p>
                </div>

                <!-- Contact Section -->
                <div>
                    <h4 class="font-heading font-semibold dark:text-white text-slate-800 mb-4">Contact Us</h4>
                    <ul class="space-y-3">
                        <li class="flex items-center gap-3 text-sm dark:text-gray-400 text-slate-500">
                            <div
                                class="w-8 h-8 rounded-full bg-brand-500/10 flex items-center justify-center text-brand-500">
                                <i class="ri-phone-line"></i>
                            </div>
                            <span class="font-medium">+91 8790627210</span>
                        </li>
                        <li class="flex items-center gap-3 text-sm dark:text-gray-400 text-slate-500">
                            <div
                                class="w-8 h-8 rounded-full bg-brand-500/10 flex items-center justify-center text-brand-500">
                                <i class="ri-mail-line"></i>
                            </div>
                            <span>support@ecoglance.ai</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div
                class="mt-12 pt-8 border-t dark:border-white/5 border-slate-200 text-center text-xs dark:text-gray-600 text-slate-400">
                &copy; 2026 EcoGlance Inc. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Stats Modal -->
    <div id="stats-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity"
            onclick="document.getElementById('stats-modal').classList.add('hidden')"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div
                class="dark:bg-dark-800 bg-white border dark:border-white/10 border-gray-200 rounded-3xl w-full max-w-3xl transform transition-all shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                <div
                    class="p-6 border-b dark:border-white/10 border-gray-100 flex justify-between items-center dark:bg-dark-900/50 bg-gray-50">
                    <h3 class="text-xl font-heading font-semibold dark:text-white text-gray-800">üìä Model Diagnostics
                    </h3>
                    <button onclick="document.getElementById('stats-modal').classList.add('hidden')"
                        class="dark:text-gray-400 text-gray-500 hover:text-red-500 transition">
                        <i class="ri-close-circle-line text-2xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto">
                    <p class="dark:text-gray-400 text-gray-600 text-sm mb-6">Historical performance metrics (RMSE, MAE,
                        R¬≤) on test set.</p>

                    <div class="overflow-x-auto rounded-xl border dark:border-white/5 border-gray-200">
                        <table class="w-full text-sm text-left dark:text-gray-400 text-gray-600">
                            <thead
                                class="text-xs uppercase dark:bg-white/5 bg-gray-100 dark:text-gray-200 text-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Target Variable</th>
                                    <th scope="col" class="px-6 py-3">RMSE</th>
                                    <th scope="col" class="px-6 py-3">MAE</th>
                                    <th scope="col" class="px-6 py-3">R¬≤ Score</th>
                                </tr>
                            </thead>
                            <tbody id="stats-body" class="divide-y dark:divide-white/5 divide-gray-100">
                                <tr>
                                    <td colspan="4" class="px-6 py-4 text-center">Loading metrics...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading"
        class="fixed inset-0 z-[200] dark:bg-dark-900/80 bg-white/80 backdrop-blur-md flex flex-col items-center justify-center transition-opacity"
        style="display: none;">
        <div class="w-16 h-16 border-4 border-brand-500/30 border-t-brand-500 rounded-full animate-spin mb-4"></div>
        <div class="dark:text-white text-slate-800 font-heading font-medium text-lg animate-pulse">Running AI
            Forecast...</div>
    </div>


    <!-- JAVASCRIPT LOGIC -->
    <script>
        let currentMethod = 'mc_dropout';
        let currentDataCache = null;
        let forecastChart = null;

        // --- THEME & UI ---
        function setMethod(method) {
            currentMethod = method;

            // Update UI buttons
            ['mc', 'quantile', 'conformal'].forEach(m => {
                const btn = document.getElementById(`btn-${m}`);
                if (!btn) return;
                if (m === method.replace('_', '')) {
                    btn.classList.add('bg-white/10', 'text-white', 'border', 'border-white/10');
                    btn.classList.remove('text-white/60');
                } else {
                    btn.classList.remove('bg-white/10', 'text-white', 'border', 'border-white/10');
                    btn.classList.add('text-white/60');
                }
            });

            fetchPrediction();
        }

        // --- CHART JS ---
        function initChart(forecastData) {
            if (!forecastData || forecastData.length === 0) return;
            currentDataCache = { forecast: forecastData };

            const ctxCheck = document.getElementById('forecastChart');
            if (!ctxCheck) return;

            const ctx = ctxCheck.getContext('2d');

            const labels = forecastData.map(d => {
                const date = new Date(d.date);
                return date.toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' });
            });

            const tempData = forecastData.map(d => parseFloat(d.temp_avg) || 0);
            const pmData = forecastData.map(d => parseFloat(d.pm2_5) || 0);

            if (forecastChart) forecastChart.destroy();

            const gridColor = 'rgba(255, 255, 255, 0.03)';
            const textColor = 'rgba(255, 255, 255, 0.4)';

            const gradientTemp = ctx.createLinearGradient(0, 0, 0, 400);
            gradientTemp.addColorStop(0, 'rgba(56, 189, 248, 0.2)');
            gradientTemp.addColorStop(1, 'rgba(56, 189, 248, 0.0)');

            const gradientPM = ctx.createLinearGradient(0, 0, 0, 400);
            gradientPM.addColorStop(0, 'rgba(16, 185, 129, 0.2)');
            gradientPM.addColorStop(1, 'rgba(16, 185, 129, 0.0)');

            forecastChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Temp (¬∞C)',
                            data: tempData,
                            borderColor: '#38bdf8',
                            backgroundColor: gradientTemp,
                            borderWidth: 4,
                            pointBackgroundColor: '#030712',
                            pointBorderColor: '#38bdf8',
                            pointHoverRadius: 6,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'PM2.5',
                            data: pmData,
                            borderColor: '#10b981',
                            backgroundColor: gradientPM,
                            borderWidth: 4,
                            pointBackgroundColor: '#030712',
                            pointBorderColor: '#10b981',
                            pointHoverRadius: 6,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'end',
                            labels: {
                                color: 'rgba(255,255,255,0.7)',
                                usePointStyle: true,
                                boxWidth: 6,
                                font: { family: 'Inter', size: 10, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#fff',
                            titleFont: { family: 'Outfit', size: 14, weight: 'bold' },
                            bodyColor: 'rgba(255,255,255,0.8)',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: textColor, font: { size: 10 } } },
                        y: { position: 'left', grid: { color: gridColor }, ticks: { color: textColor } },
                        y1: { position: 'right', grid: { display: false }, ticks: { color: '#10b981', font: { size: 10 } } }
                    }
                }
            });
        }

        // --- HELPERS ---
        function getWeatherIcon(rainfall, temp) {
            if (rainfall > 15) return "‚õàÔ∏è";
            if (rainfall > 5) return "üåßÔ∏è";
            if (rainfall > 0.5) return "üå¶Ô∏è";
            if (temp > 35) return "‚òÄÔ∏è";
            if (temp > 30) return "‚òÄÔ∏è";
            return "üå§Ô∏è";
        }

        function getAQIColor(pm25) {
            const cls = { bg: 'rgba(16, 185, 129, 0.1)', text: '#10b981' };
            if (pm25 > 30) { cls.bg = 'rgba(234, 179, 8, 0.1)'; cls.text = '#eab308'; }
            if (pm25 > 60) { cls.bg = 'rgba(249, 115, 22, 0.1)'; cls.text = '#f97316'; }
            if (pm25 > 90) { cls.bg = 'rgba(239, 68, 68, 0.1)'; cls.text = '#ef4444'; }
            return cls;
        }

        // --- FETCH LOGIC ---
        async function fetchPrediction() {
            const loading = document.getElementById('loading');
            loading.style.display = 'flex';

            try {
                const res = await fetch(`/predict?method=${currentMethod}`);
                if (!res.ok) {
                    const errData = await res.json();
                    throw new Error(errData.error || 'Server Error');
                }
                const data = await res.json();

                // Update Hero Content
                const tempVal = Math.round(data.data.temp_avg);
                document.getElementById('temp-main').innerHTML = `${tempVal}<span class="text-6xl text-white/20">¬∞</span>`;
                document.getElementById('feels-like').textContent = tempVal + '¬∞';
                document.getElementById('humidity-detail').textContent = Math.round(data.data.humidity) + '%';
                document.getElementById('wind-detail').innerHTML = `${data.data.wind_speed.toFixed(1)} <span class="text-[10px] opacity-40">m/s</span>`;
                document.getElementById('rain-detail').innerHTML = `${data.data.rainfall.toFixed(1)} <span class="text-[10px] opacity-40">mm</span>`;

                const weatherIcon = getWeatherIcon(data.data.rainfall, data.data.temp_avg);
                document.getElementById('weather-icon-main').textContent = weatherIcon;

                // Condition description
                let condition = 'Clear Skies';
                if (data.data.rainfall > 5) condition = 'Heavy Rain';
                else if (data.data.rainfall > 0.5) condition = 'Showers';
                else if (data.data.cloud_cover > 50) condition = 'Overcast';
                document.getElementById('weather-desc').textContent = condition;

                // Current Date
                const dateObj = new Date(data.prediction_date);
                document.getElementById('current-date').textContent = dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });

                // AQI Logic
                const pm25 = parseFloat(data.data.pm2_5) || 0;
                document.getElementById('pm25-large').textContent = Math.round(pm25);
                document.getElementById('pm10-metric').innerHTML = `${Math.round(data.data.pm10)} <span class="text-[10px] opacity-40">¬µg/m¬≥</span>`;

                const aqiStatus = document.getElementById('aqi-status-badge');
                aqiStatus.textContent = data.aqi.status;
                const aqiColors = getAQIColor(pm25);
                aqiStatus.style.backgroundColor = aqiColors.bg;
                aqiStatus.style.color = aqiColors.text;
                aqiStatus.style.borderColor = aqiColors.text + '20';

                // Gauge Update
                const ring = document.getElementById('aqi-ring');
                const circumference = 2 * Math.PI * 45;
                const progress = Math.min(pm25 / 100, 1);
                ring.style.strokeDashoffset = circumference * (1 - progress);

                // Recommendations
                if (data.aqi.recommendations) {
                    const rec = data.aqi.recommendations;
                    document.getElementById('rec-title').textContent = rec.title;
                    document.getElementById('rec-summary').textContent = rec.summary;
                    document.getElementById('rec-do').innerHTML = rec.do.slice(0, 3).map(x =>
                        `<li class="flex items-center gap-3">
                            <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                            <span class="text-xs font-bold text-white/50">${x}</span>
                        </li>`).join('');

                    if (rec.avoid && rec.avoid.length) {
                        document.getElementById('rec-avoid-section').classList.remove('hidden');
                        document.getElementById('rec-avoid').innerHTML = rec.avoid.slice(0, 2).map(x =>
                            `<li class="flex items-center gap-3">
                                <div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>
                                <span class="text-xs font-bold text-white/50">${x}</span>
                            </li>`).join('');
                    } else {
                        document.getElementById('rec-avoid-section').classList.add('hidden');
                    }
                }

                // Chart & Forecast List
                initChart(data.forecast);
                renderForecastList(data.forecast);

            } catch (err) {
                console.error(err);
                alert('Intelligence Engine Sync Error: ' + err.message);
            } finally {
                loading.style.display = 'none';
            }
        }

        function renderForecastList(forecast) {
            const container = document.getElementById('forecast-list');
            container.innerHTML = forecast.map((d, i) => {
                const date = new Date(d.date);
                const day = date.toLocaleDateString('en-US', { weekday: 'short' });
                const icon = getWeatherIcon(d.rainfall, d.temp_avg);
                const isToday = i === 0;

                return `
                    <div class="glass-card rounded-[32px] p-6 flex flex-col items-center gap-4 group cursor-pointer ${isToday ? 'border-brand-500/50 bg-white/5' : ''}">
                        <span class="text-[10px] font-black uppercase tracking-widest ${isToday ? 'text-brand-400' : 'text-white/30'}">${day}</span>
                        <span class="text-4xl group-hover:scale-125 transition-transform duration-500">${icon}</span>
                        <div>
                            <span class="text-lg font-bold text-white/90">${Math.round(d.temp_avg)}¬∞</span>
                            <div class="h-1 w-1 bg-white/10 rounded-full mx-auto mt-1"></div>
                        </div>
                        <span class="text-[9px] font-black text-green-500/40 uppercase tracking-tighter">${Math.round(d.pm2_5)} PM</span>
                    </div>
                `;
            }).join('');
        }

        async function fetchStats() {
            try {
                const res = await fetch('/stats');
                const data = await res.json();
                const body = document.getElementById('stats-body');

                if (!data || data.length === 0) {
                    body.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-white/30 font-bold uppercase tracking-widest">No diagnostics available yet</td></tr>';
                    return;
                }

                body.innerHTML = data.map(m => `
                    <tr class="hover:bg-white/5 transition-colors border-b border-white/5 last:border-0">
                        <th class="px-6 py-4 font-bold text-white/90 uppercase tracking-wide text-xs">${(m.target || 'N/A').replace('xgb_chain_', '').replace('.pkl', '')}</th>
                        <td class="px-6 py-4 font-mono text-brand-400 font-bold">${Number(m.rmse || 0).toFixed(3)}</td>
                        <td class="px-6 py-4 font-mono text-indigo-400 font-bold">${Number(m.mae || 0).toFixed(3)}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-lg bg-white/5 text-[10px] font-black font-mono tracking-tighter ${(m.r2 || 0) > 0.8 ? 'text-green-400' : 'text-yellow-400'}">
                                ${Number(m.r2 || 0).toFixed(3)}
                            </span>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error(err);
            }
        }

        // --- INIT ---
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 20) nav.classList.add('bg-[#030712]/80', 'py-1');
            else nav.classList.remove('bg-[#030712]/80', 'py-1');
        });

        // Load initially
        document.addEventListener('DOMContentLoaded', () => {
            setMethod('mc_dropout');
            fetchStats();
        });
    </script>
</body>

</html>